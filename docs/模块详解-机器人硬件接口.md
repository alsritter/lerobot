# LeRobot 机器人硬件接口详解 (Robots Module)

## 概述

机器人模块是 LeRobot 框架中负责硬件抽象和控制的核心组件。该模块提供了统一的接口来控制不同类型的机器人硬件，从低成本的桌面机械臂到复杂的人形机器人。

## 模块结构

```
robots/
├── __init__.py              # 模块初始化和公共接口
├── robot.py                 # 机器人抽象基类
├── config.py                # 机器人配置管理
├── utils.py                 # 机器人相关工具函数
├── bi_so100_follower/       # 双臂 SO-100 从属机器人
├── hope_jr/                 # HopeJR 人形机器人手臂
├── koch_follower/           # Koch 从属机器人
├── lekiwi/                  # LeKiwi 移动机器人
├── reachy2/                 # Reachy2 人形机器人
├── so100_follower/          # SO-100 单臂从属机器人
└── so101_follower/          # SO-101 从属机器人
```

## 机器人抽象基类

### `robot.py`
定义了所有机器人必须实现的统一接口：

```python
class Robot:
    """机器人抽象基类"""
    
    def connect(self) -> None:
        """连接到机器人硬件"""
        pass
    
    def disconnect(self) -> None:
        """断开机器人连接"""
        pass
    
    def read_position(self) -> torch.Tensor:
        """读取当前位置"""
        pass
    
    def write_position(self, position: torch.Tensor) -> None:
        """写入目标位置"""
        pass
    
    def is_connected(self) -> bool:
        """检查连接状态"""
        pass
```

## 支持的机器人平台

### 1. SO-100 系列 (低成本机械臂)

#### SO-100 单臂版本
**路径**: `so100_follower/`

SO-100 是一个低成本的桌面机械臂，价格约为 114 欧元。

**主要特点**:
- 6 自由度关节
- Feetech 舵机驱动
- USB 串口通信
- 精度适中，成本极低
- 适合教育和原型开发

**技术规格**:
- 负载能力: ~500g
- 工作半径: ~40cm
- 重复精度: ±2mm
- 通信协议: UART over USB

#### SO-101 改进版本
**路径**: `so101_follower/`

SO-101 是 SO-100 的改进版本，提供更好的性能和可靠性。

**改进点**:
- 更好的机械设计
- 改进的舵机固件
- 更稳定的通信协议
- 增强的安全机制

#### 双臂 SO-100 系统
**路径**: `bi_so100_follower/`

基于两个 SO-100 机械臂构建的双臂系统，类似于 ALOHA 的配置。

**主要特点**:
- 双臂协调控制
- 主从遥操作支持
- 双手操作任务
- 成本效益高的双臂方案

### 2. HopeJR 人形机器人手臂
**路径**: `hope_jr/`

HopeJR 是一个人形机器人的手臂系统，专为复杂操作任务设计。

**主要特点**:
- 人体尺寸的手臂设计
- 高精度伺服电机
- 力反馈传感器
- 复杂的关节配置

**技术规格**:
- 7 自由度 (类人手臂)
- 负载能力: 2-3kg
- 重复精度: ±0.5mm
- 力控制能力

**应用场景**:
- 人机交互研究
- 复杂操作任务
- 仿人机器人研究

### 3. LeKiwi 移动机器人
**路径**: `lekiwi/`

LeKiwi 是一个移动机器人平台，结合了导航和操作能力。

**主要特点**:
- 全向移动底盘
- 集成机械臂
- 多传感器融合
- SLAM 导航能力

**系统组成**:
- 移动底盘控制
- 机械臂控制
- 传感器数据融合
- 路径规划和执行

### 4. Reachy2 人形机器人
**路径**: `reachy2/`

Reachy2 是 Pollen Robotics 开发的人形机器人，具有高度的灵活性。

**主要特点**:
- 全身人形设计
- 双臂 + 头部系统
- 高质量的视觉系统
- ROS 2 集成

**技术特点**:
- 14+ 自由度
- 模块化设计
- 实时操作系统
- 丰富的 API 接口

### 5. Koch 从属机器人
**路径**: `koch_follower/`

Koch 机器人是一个用于遥操作研究的从属机器人系统。

**主要特点**:
- 主从遥操作
- 高保真度控制
- 实时反馈
- 研究级精度

## 配置管理系统

### `config.py`
统一管理所有机器人的配置参数：

```python
class RobotConfig:
    """机器人配置基类"""
    
    def __init__(self):
        self.motors = {}           # 电机配置
        self.cameras = {}          # 摄像头配置
        self.sensors = {}          # 传感器配置
        self.communication = {}    # 通信配置
        self.safety = {}           # 安全配置
```

**配置内容**:
- 电机参数和限制
- 摄像头设置和标定
- 传感器配置和滤波
- 通信协议和端口
- 安全阈值和保护

## 硬件通信层

### 通信协议支持
- **串口通信**: UART/USB 接口
- **以太网通信**: TCP/UDP 协议  
- **CAN 总线**: 工业标准通信
- **无线通信**: WiFi/蓝牙支持

### 数据格式
- 关节位置/速度/力矩
- 传感器数据流
- 状态和诊断信息
- 命令确认和错误报告

## 安全机制

### 硬件安全
- 关节限位保护
- 过载检测和保护
- 急停机制
- 电源管理

### 软件安全
- 输入验证和限制
- 运动学检查
- 碰撞检测
- 超时和重试机制

### 监控系统
- 实时状态监控
- 异常检测和报警
- 日志记录和分析
- 远程诊断支持

## 控制接口

### 位置控制
```python
def set_joint_positions(self, positions: torch.Tensor) -> None:
    """设置关节目标位置"""
    pass

def get_joint_positions(self) -> torch.Tensor:
    """获取当前关节位置"""
    pass
```

### 速度控制
```python
def set_joint_velocities(self, velocities: torch.Tensor) -> None:
    """设置关节目标速度"""
    pass
```

### 力矩控制
```python
def set_joint_torques(self, torques: torch.Tensor) -> None:
    """设置关节目标力矩"""
    pass
```

### 笛卡尔控制
```python
def set_end_effector_pose(self, pose: torch.Tensor) -> None:
    """设置末端执行器目标姿态"""
    pass
```

## 传感器集成

### 内置传感器
- 关节编码器
- 力矩传感器
- 温度传感器
- 电流传感器

### 外部传感器
- 六维力传感器
- IMU 姿态传感器
- 触觉传感器
- 距离传感器

## 标定和校准

### 关节标定
- 零点标定
- 关节限位标定
- 编码器标定
- 齿轮比标定

### 运动学标定
- DH 参数标定
- 末端执行器标定
- 相机-机器人标定
- 工具坐标系标定

## 遥操作支持

### 主从控制
- 实时位置映射
- 力反馈控制
- 双向通信
- 延迟补偿

### 输入设备支持
- 触觉设备
- 游戏手柄
- 键盘鼠标
- 移动设备

## 性能优化

### 实时控制
- 确定性通信
- 低延迟处理
- 优先级调度
- 缓存优化

### 并发处理
- 多线程架构
- 异步 I/O
- 任务队列
- 资源管理

## 开发和调试

### 仿真集成
- Gazebo 仿真器
- MuJoCo 物理引擎
- Unity 3D 环境
- 自定义仿真器

### 调试工具
- 实时数据可视化
- 关节状态监控
- 轨迹记录回放
- 性能分析工具

## 扩展新机器人

### 添加步骤
1. **创建机器人目录**
2. **实现基类接口**
3. **配置参数文件**
4. **通信协议实现**
5. **安全机制集成**
6. **测试和验证**

### 最佳实践
- 遵循统一接口规范
- 完善的错误处理
- 详细的文档说明
- 充分的测试覆盖

## 与其他模块的集成

### 与策略模块
- 观测空间定义
- 动作空间映射
- 实时控制接口
- 状态反馈机制

### 与摄像头模块
- 视觉系统集成
- 手眼标定
- 视觉伺服控制
- 多相机同步

### 与环境模块
- 仿真环境对接
- 真实环境适配
- 任务执行接口
- 奖励信号集成

这个机器人模块为 LeRobot 提供了强大的硬件抽象能力，使得不同的机器人平台可以使用相同的高层策略和算法，大大降低了机器人学习的门槛。